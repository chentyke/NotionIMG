<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NotionRenderer 修复测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .success {
            color: #28a745;
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            color: #721c24;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>NotionRenderer.js 修复测试</h1>
        <p>这个页面用于测试重构后的notionRenderer.js是否能正常导入和运行。</p>
        
        <div id="test-results">
            <h2>测试结果</h2>
            <div id="import-test" class="test-result">
                <strong>模块导入测试:</strong> <span id="import-status">测试中...</span>
            </div>
            <div id="function-test" class="test-result">
                <strong>函数可用性测试:</strong> <span id="function-status">等待导入...</span>
            </div>
            <div id="render-test" class="test-result">
                <strong>渲染功能测试:</strong> <span id="render-status">等待导入...</span>
            </div>
        </div>

        <div id="render-output" style="margin-top: 20px;">
            <h3>渲染输出测试</h3>
            <div id="test-content"></div>
        </div>
    </div>

    <script type="module">
        async function runTests() {
            const importTest = document.getElementById('import-status');
            const functionTest = document.getElementById('function-status');
            const renderTest = document.getElementById('render-status');
            const testContent = document.getElementById('test-content');

            try {
                // 测试1: 模块导入
                importTest.textContent = '正在导入模块...';
                
                const notionRenderer = await import('./static/js/modules/notionRenderer.js');
                
                importTest.innerHTML = '<span style="color: #28a745;">✅ 成功导入</span>';
                importTest.parentElement.className = 'test-result success';

                // 测试2: 函数可用性
                functionTest.textContent = '检查导出的函数...';
                
                const requiredFunctions = [
                    'loadPage', 'loadChildPage', 'renderBlock', 
                    'toggleBlock', 'copyCode', 'copyPageLink', 
                    'transitionToPage', 'PageTransition'
                ];
                
                const missingFunctions = requiredFunctions.filter(fn => !notionRenderer[fn]);
                
                if (missingFunctions.length === 0) {
                    functionTest.innerHTML = '<span style="color: #28a745;">✅ 所有必需函数都可用</span>';
                    functionTest.parentElement.className = 'test-result success';
                } else {
                    functionTest.innerHTML = `<span style="color: #dc3545;">❌ 缺少函数: ${missingFunctions.join(', ')}</span>`;
                    functionTest.parentElement.className = 'test-result error';
                }

                // 测试3: 渲染功能
                renderTest.textContent = '测试渲染功能...';
                
                // 模拟一个简单的块数据
                const testBlock = {
                    type: 'paragraph',
                    text: '这是一个测试段落，用于验证渲染功能是否正常工作。',
                    color: 'default'
                };

                try {
                    // 注意：renderBlock函数需要一些全局依赖，所以我们只测试它是否存在
                    if (typeof notionRenderer.renderBlock === 'function') {
                        renderTest.innerHTML = '<span style="color: #28a745;">✅ renderBlock函数可用</span>';
                        renderTest.parentElement.className = 'test-result success';
                        
                        testContent.innerHTML = `
                            <div style="background: #e9ecef; padding: 10px; border-radius: 4px;">
                                <strong>模拟渲染输出:</strong><br>
                                &lt;p&gt;${testBlock.text}&lt;/p&gt;
                            </div>
                        `;
                    } else {
                        renderTest.innerHTML = '<span style="color: #dc3545;">❌ renderBlock函数不可用</span>';
                        renderTest.parentElement.className = 'test-result error';
                    }
                } catch (renderError) {
                    renderTest.innerHTML = `<span style="color: #dc3545;">❌ 渲染测试失败: ${renderError.message}</span>`;
                    renderTest.parentElement.className = 'test-result error';
                }

            } catch (error) {
                importTest.innerHTML = `<span style="color: #dc3545;">❌ 导入失败: ${error.message}</span>`;
                importTest.parentElement.className = 'test-result error';
                
                functionTest.innerHTML = '<span style="color: #6c757d;">⏸️ 跳过 - 导入失败</span>';
                renderTest.innerHTML = '<span style="color: #6c757d;">⏸️ 跳过 - 导入失败</span>';
                
                console.error('模块导入错误:', error);
            }
        }

        // 运行测试
        document.addEventListener('DOMContentLoaded', runTests);
    </script>
</body>
</html> 