<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOC 居中修复测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f9fafb;
        }
        
        .header {
            text-align: center;
            padding: 40px 0;
            background: white;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        
        .section {
            background: white;
            padding: 30px;
            margin: 20px 0;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        
        h1, h2, h3 {
            color: #1f2937;
            margin-top: 0;
        }
        
        h1 { font-size: 2rem; }
        h2 { font-size: 1.5rem; }
        h3 { font-size: 1.2rem; }
        
        .test-description {
            background: #3b82f6;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .test-steps {
            background: #f3f4f6;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .test-steps ol {
            margin: 0;
            padding-left: 20px;
        }
        
        .expected-result {
            background: #ecfdf5;
            border: 2px solid #10b981;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .previous-issue {
            background: #fef2f2;
            border: 2px solid #ef4444;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .simulate-scroll {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            z-index: 1000;
        }
        
        .simulate-scroll:hover {
            background: #2563eb;
        }
        
        .scroll-indicator {
            position: fixed;
            top: 60px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 0.875rem;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <button class="simulate-scroll" onclick="simulateScrollToMiddle()">模拟滚动到中间</button>
    <div class="scroll-indicator" id="scrollIndicator">滚动位置: 0px</div>
    
    <div class="header">
        <h1>TOC 居中修复测试</h1>
        <p>测试浮动目录在打开时是否正确居中显示当前章节</p>
    </div>
    
    <div class="test-description">
        <h2>测试说明</h2>
        <p><strong>修复内容：</strong>解决了浮动TOC每次打开时总是跳到顶部，而不是居中显示当前正在阅读章节的问题。</p>
        <p><strong>修复方案：</strong>将滚动位置设置延迟到目录完全展开后执行，并使用双重保险机制（setTimeout + requestAnimationFrame）确保DOM完全渲染。</p>
    </div>
    
    <div class="previous-issue">
        <h3>之前的问题</h3>
        <ul>
            <li>目录打开时总是显示第一个章节（顶部）</li>
            <li>用户需要手动滚动查找当前阅读位置</li>
            <li>影响了用户的导航体验</li>
            <li>在长文档中特别明显</li>
        </ul>
    </div>
    
    <div class="expected-result">
        <h3>修复后的预期效果</h3>
        <ul>
            <li>✅ 目录打开时自动居中显示当前章节</li>
            <li>✅ 当前章节会有视觉强调效果（短暂的高亮动画）</li>
            <li>✅ 用户可以立即看到当前位置和上下文</li>
            <li>✅ 提升了长文档的导航体验</li>
        </ul>
    </div>
    
    <div class="test-steps">
        <h3>测试步骤</h3>
        <ol>
            <li>打开实际的 Notion 页面</li>
            <li>滚动到页面中间的某个章节</li>
            <li>点击浮动标题栏打开TOC</li>
            <li>观察TOC是否自动居中显示当前章节</li>
            <li>关闭TOC，滚动到其他位置，重复测试</li>
        </ol>
    </div>
    
    <!-- 生成大量内容用于滚动测试 -->
    <div class="section" id="section1">
        <h2>第一章：开始</h2>
        <p>这是第一章的内容。包含了一些基础的介绍和说明。这里有足够的文本内容来模拟真实的文档。</p>
        <h3>1.1 子章节</h3>
        <p>这是第一章的子章节内容。包含更详细的信息和说明。</p>
        <p>更多的文本内容来增加页面长度，模拟真实的长文档情况。这样用户在实际使用时可以感受到滚动的效果。</p>
    </div>
    
    <div class="section" id="section2">
        <h2>第二章：进阶</h2>
        <p>这是第二章的内容。包含了进阶的技术说明和详细的操作指南。</p>
        <h3>2.1 技术细节</h3>
        <p>这里详细介绍了技术实现的各个方面，包括算法、数据结构等内容。</p>
        <h3>2.2 实践应用</h3>
        <p>这里介绍了实际应用中的经验和最佳实践。</p>
        <p>更多的文本内容来增加页面长度，确保有足够的滚动空间进行测试。</p>
    </div>
    
    <div class="section" id="section3">
        <h2>第三章：高级特性</h2>
        <p>这是第三章的内容。专注于高级特性和复杂场景的处理。</p>
        <h3>3.1 复杂算法</h3>
        <p>介绍复杂算法的实现和优化策略。</p>
        <h3>3.2 性能优化</h3>
        <p>详细说明性能优化的方法和技巧。</p>
        <h3>3.3 错误处理</h3>
        <p>全面介绍错误处理和异常管理的最佳实践。</p>
        <p>这里是第三章的更多内容，用于测试目录居中功能的效果。</p>
    </div>
    
    <div class="section" id="section4">
        <h2>第四章：最佳实践</h2>
        <p>这是第四章的内容。总结了各种最佳实践和经验分享。</p>
        <h3>4.1 设计模式</h3>
        <p>介绍常用的设计模式及其应用场景。</p>
        <h3>4.2 代码组织</h3>
        <p>说明代码组织和架构设计的原则。</p>
        <p>更多内容用于测试滚动和目录定位功能。</p>
    </div>
    
    <div class="section" id="section5">
        <h2>第五章：总结</h2>
        <p>这是最后一章的内容。对前面所有内容进行总结和回顾。</p>
        <h3>5.1 核心要点</h3>
        <p>总结核心的技术要点和关键概念。</p>
        <h3>5.2 未来展望</h3>
        <p>展望技术发展的趋势和未来的可能性。</p>
        <p>这里是文档的结尾部分，用于完成滚动测试。</p>
    </div>
    
    <script>
        // 模拟滚动到页面中间
        function simulateScrollToMiddle() {
            const targetPosition = document.body.scrollHeight * 0.4; // 滚动到40%位置
            window.scrollTo({
                top: targetPosition,
                behavior: 'smooth'
            });
        }
        
        // 显示当前滚动位置
        function updateScrollIndicator() {
            const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
            const scrollPercentage = (scrollPosition / (document.body.scrollHeight - window.innerHeight) * 100).toFixed(1);
            document.getElementById('scrollIndicator').textContent = 
                `滚动位置: ${scrollPosition}px (${scrollPercentage}%)`;
        }
        
        // 监听滚动事件
        window.addEventListener('scroll', updateScrollIndicator, { passive: true });
        
        // 初始更新
        updateScrollIndicator();
    </script>
</body>
</html> 