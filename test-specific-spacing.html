<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第16-17块间距测试</title>
    <link rel="stylesheet" href="static/css/typography.css">
    <link rel="stylesheet" href="static/css/base.css">
    <link rel="stylesheet" href="static/css/styles.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
        }
        
        .test-container {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .block-indicator {
            position: relative;
            padding-left: 3rem;
        }
        
        .block-indicator::before {
            content: attr(data-block);
            position: absolute;
            left: 0;
            top: 0;
            background: #3b82f6;
            color: white;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 0.25rem;
            font-weight: bold;
        }
        
        .batch-divider {
            border-top: 2px dashed #ef4444;
            margin: 1rem 0;
            position: relative;
        }
        
        .batch-divider::after {
            content: "批次边界 (第15-16块之间)";
            position: absolute;
            top: -0.5rem;
            left: 1rem;
            background: white;
            color: #ef4444;
            padding: 0 0.5rem;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .spacing-test {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
        }
        
        .fix-info {
            background: #dcfce7;
            border: 1px solid #bbf7d0;
            color: #166534;
            padding: 0.75rem;
            border-radius: 0.375rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <h1>🔍 第16-17块间距问题诊断</h1>
    
    <div class="fix-info">
        <strong>问题描述：</strong>用户报告第16和第17个块之间存在异常间距。<br>
        <strong>可能原因：</strong>批次边界处理、CSS类不一致、margin collapse问题。
    </div>
    
    <div class="spacing-test">
        <h2>模拟问题场景</h2>
        <p>以下内容模拟第一批加载（1-15块）和第二批加载（16+块）的边界：</p>
        
        <div class="test-container prose">
            <!-- 第一批内容 (1-15块) -->
            <div class="block-indicator" data-block="1"><p>第1个段落块</p></div>
            <div class="block-indicator" data-block="2"><p>第2个段落块</p></div>
            <div class="block-indicator" data-block="3"><h2>第3个标题块</h2></div>
            <div class="block-indicator" data-block="4"><p>第4个段落块</p></div>
            
            <div class="block-indicator" data-block="5-10">
                <ol class="prose-list list-decimal ml-6" start="1">
                    <li>第5个列表项</li>
                    <li>第6个列表项</li>
                    <li>第7个列表项</li>
                    <li>第8个列表项</li>
                    <li>第9个列表项</li>
                    <li>第10个列表项</li>
                </ol>
            </div>
            
            <div class="block-indicator" data-block="11"><p>第11个段落块</p></div>
            <div class="block-indicator" data-block="12"><p>第12个段落块</p></div>
            <div class="block-indicator" data-block="13"><p>第13个段落块</p></div>
            <div class="block-indicator" data-block="14"><p>第14个段落块</p></div>
            <div class="block-indicator" data-block="15"><p>第15个段落块（第一批结束）</p></div>
            
            <!-- 批次分界线 -->
            <div class="batch-divider"></div>
            
            <!-- 第二批内容 (16+块) - 可能有异常间距 -->
            <div class="block-indicator" data-block="16">
                <p class="new-content-block new-content-show">第16个段落块（第二批开始）</p>
            </div>
            <div class="block-indicator" data-block="17">
                <p class="new-content-block new-content-show">第17个段落块</p>
            </div>
            <div class="block-indicator" data-block="18"><p>第18个段落块</p></div>
        </div>
    </div>
    
    <div class="spacing-test">
        <h2>对比测试 - 连续渲染</h2>
        <p>以下内容模拟连续渲染（无批次边界）的正常间距：</p>
        
        <div class="test-container prose">
            <div class="block-indicator" data-block="14"><p>第14个段落块</p></div>
            <div class="block-indicator" data-block="15"><p>第15个段落块</p></div>
            <div class="block-indicator" data-block="16"><p>第16个段落块（无批次边界）</p></div>
            <div class="block-indicator" data-block="17"><p>第17个段落块</p></div>
            <div class="block-indicator" data-block="18"><p>第18个段落块</p></div>
        </div>
    </div>
    
    <div class="spacing-test">
        <h2>CSS类对比测试</h2>
        <div class="test-container prose">
            <h3>使用new-content-block类</h3>
            <p class="new-content-block new-content-show">这是使用new-content-block类的段落</p>
            <p class="new-content-block new-content-show">这是另一个使用new-content-block类的段落</p>
            
            <h3>使用正常CSS类</h3>
            <p>这是正常的段落</p>
            <p>这是另一个正常的段落</p>
        </div>
    </div>
    
    <div class="spacing-test">
        <h2>列表结束测试</h2>
        <div class="test-container prose">
            <p>列表前的段落</p>
            <ol class="prose-list list-decimal ml-6">
                <li>列表项1</li>
                <li>列表项2</li>
                <li>列表项3</li>
            </ol>
            <p class="new-content-block new-content-show">列表后的段落（第二批）</p>
            <p>列表后的普通段落</p>
        </div>
    </div>
    
    <script>
        // 检查实际间距
        function measureSpacing() {
            const blocks = document.querySelectorAll('[data-block]');
            blocks.forEach((block, index) => {
                if (index > 0) {
                    const prevBlock = blocks[index - 1];
                    const rect1 = prevBlock.getBoundingClientRect();
                    const rect2 = block.getBoundingClientRect();
                    const spacing = rect2.top - rect1.bottom;
                    
                    console.log(`Block ${prevBlock.dataset.block} -> ${block.dataset.block}: ${spacing.toFixed(2)}px`);
                    
                    // 特别关注第15-16块的间距
                    if (prevBlock.dataset.block === '15' && block.dataset.block === '16') {
                        const indicator = document.createElement('div');
                        indicator.style.cssText = `
                            position: absolute;
                            left: 0;
                            right: 0;
                            height: 2px;
                            background: red;
                            top: ${rect1.bottom + window.scrollY}px;
                            z-index: 1000;
                        `;
                        indicator.innerHTML = `<span style="background: red; color: white; padding: 2px 4px; font-size: 10px;">间距: ${spacing.toFixed(2)}px</span>`;
                        document.body.appendChild(indicator);
                    }
                }
            });
        }
        
        // 页面加载后测量间距
        window.addEventListener('load', () => {
            setTimeout(measureSpacing, 100);
        });
        
        // 添加按钮手动测量
        const button = document.createElement('button');
        button.textContent = '测量间距';
        button.style.cssText = 'position: fixed; top: 10px; right: 10px; z-index: 1001; padding: 8px 12px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;';
        button.onclick = measureSpacing;
        document.body.appendChild(button);
    </script>
</body>
</html> 